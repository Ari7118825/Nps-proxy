<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Static Pure-JS Proxy</title>
    <style>
        body, html { margin: 0; padding: 0; height: 100%; overflow: hidden; font-family: sans-serif; }
        #nav-bar { height: 50px; background: #222; display: flex; align-items: center; padding: 0 15px; gap: 10px; color: white; }
        input { flex: 1; padding: 8px; border-radius: 4px; border: none; }
        button { padding: 8px 15px; cursor: pointer; background: #007bff; color: white; border: none; border-radius: 4px; }
        iframe { width: 100%; height: calc(100vh - 50px); border: none; background: white; }
    </style>
</head>
<body>

<div id="nav-bar">
    <strong>Proxy:</strong>
    <input type="text" id="urlInput" placeholder="https://www.google.com" onkeydown="if(event.key==='Enter') launch()">
    <button onclick="launch()">Go</button>
</div>

<iframe id="proxyFrame"></iframe>

<script>
    const PROXY_API = "https://api.codetabs.com/v1/proxy?quest=";

    async function launch() {
        let targetUrl = document.getElementById('urlInput').value;
        if (!targetUrl.startsWith('http')) targetUrl = 'https://' + targetUrl;
        
        const frame = document.getElementById('proxyFrame');
        
        try {
            const response = await fetch(PROXY_API + encodeURIComponent(targetUrl));
            let html = await response.text();

            // Create a temporary document to parse the HTML
            const parser = new DOMParser();
            const doc = parser.parseFromString(html, 'text/html');

            // 1. Resolve relative links using the <base> tag
            const base = doc.createElement('base');
            base.href = targetUrl;
            doc.head.prepend(base);

            // 2. Inject a script to "hook" clicks and forms
            const hookScript = doc.createElement('script');
            hookScript.textContent = `
                document.addEventListener('click', e => {
                    const link = e.target.closest('a');
                    if (link && link.href) {
                        e.preventDefault();
                        window.parent.postMessage({type: 'nav', url: link.href}, '*');
                    }
                });
                document.addEventListener('submit', e => {
                    const form = e.target;
                    e.preventDefault();
                    const url = new URL(form.action, document.baseURI).href;
                    window.parent.postMessage({type: 'nav', url: url}, '*');
                });
            `;
            doc.head.appendChild(hookScript);

            // 3. Update the iframe
            frame.srcdoc = doc.documentElement.outerHTML;
            
        } catch (err) {
            alert("Error: The proxy couldn't fetch this site. It might be blocked or down.");
        }
    }

    // Listen for navigation messages from the "hooked" iframe
    window.addEventListener('message', e => {
        if (e.data.type === 'nav') {
            document.getElementById('urlInput').value = e.data.url;
            launch();
        }
    });
</script>

</body>
</html>
