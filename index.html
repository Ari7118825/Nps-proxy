<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>CORS Tunnel Test</title>
    <style>
        body, html { margin: 0; padding: 0; height: 100%; overflow: hidden; font-family: sans-serif; }
        #container { width: 100vw; height: 100vh; border: none; }
        #status { position: fixed; bottom: 10px; right: 10px; background: rgba(0,0,0,0.7); color: white; padding: 5px 10px; border-radius: 5px; font-size: 12px; }
    </style>
</head>
<body>

    <div id="status">Status: Initializing...</div>
    <div id="container"></div>

    <script>
        const status = document.getElementById('status');
        const proxyBase = "https://api.codetabs.com/v1/proxy?quest=";
        const targetSite = "https://www.croxyproxy.com/";

        // 1. Register the Service Worker Interceptor
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('sw.js').then(() => {
                status.innerText = "Status: Proxy Active. Loading...";
                loadSite();
            }).catch(err => {
                status.innerText = "Status: Worker Failed: " + err;
            });
        }

        async function loadSite() {
            try {
                const response = await fetch(proxyBase + encodeURIComponent(targetSite));
                let html = await response.text();

                // Inject a <base> tag so relative assets try to load from CroxyProxy
                // The Service Worker will then catch these and tunnel them
                const baseTag = `<base href="${targetSite}">`;
                html = html.replace('<head>', `<head>${baseTag}`);

                document.getElementById('container').innerHTML = html;
                status.innerText = "Status: Site Injected.";
                
                // Note: Scripts in innerHTML don't run. 
                // A fully-fledged version requires a recursive script injector.
            } catch (e) {
                status.innerText = "Status: Load Error.";
            }
        }
    </script>
</body>
</html>
